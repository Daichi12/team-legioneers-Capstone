const express=require("express"),Router=require("./Router"),BASE_DIR=__dirname+"/../../../../";class APIRouter{constructor(e){this.site_id=e.site_id,this.api_key=e.api_key,this.env=e.env||"dev",this.tmp=e.tmp||"/tmp",this.createRouter=this.createRouter.bind(this),this.populateRouter=this.populateRouter.bind(this),this.local=this.local.bind(this),this.prod=this.prod.bind(this)}createRouter(e){return new express.Router}populateRouter(e,s,t){e.get("/",(e,t)=>{const o=[];Object.keys(s).forEach(e=>{const t=s[e];o.push({name:e,collectionName:t.collectionName(),schema:t.schema()})}),t.json({confirmation:"success",data:o})}),e.get("/:resource",(e,t)=>{const o=s[e.params.resource];null!=o?o.get(e.query).then(e=>{t.json({confirmation:"success",data:e})}).catch(e=>{t.json({confirmation:"fail",message:e.message})}):t.json({confirmation:"fail",message:"Invalid resource"})}),e.get("/:resource/:id",(e,t)=>{const o=s[e.params.resource];null!=o?o.getById(e.params.id).then(e=>{t.json({confirmation:"success",data:e})}).catch(e=>{t.json({confirmation:"fail",message:e.message})}):t.json({confirmation:"fail",message:"Invalid resource"})}),e.post("/:resource",(e,t)=>{const o=s[e.params.resource];null!=o?o.post(e.body).then(e=>{t.json({confirmation:"success",data:e})}).catch(e=>{t.json({confirmation:"fail",message:e.message})}):t.json({confirmation:"fail",message:"Invalid resource"})}),e.put("/:resource/:id",(e,t)=>{const o=s[e.params.resource];null!=o?o.put(e.params.id,params).then(e=>{t.json({confirmation:"success",data:e})}).catch(e=>{t.json({confirmation:"fail",message:e.message})}):t.json({confirmation:"fail",message:"Invalid resource"})}),e.delete("/:resource/:id",(e,t)=>{const o=s[e.params.resource];null!=o?o.delete(e.params.id,null).then(()=>{t.json({confirmation:"success",data:{id:e.params.id}})}).catch(e=>{t.json({confirmation:"fail",message:e.message})}):t.json({confirmation:"fail",message:"Invalid resource"})})}local(e){const s=this.createRouter("dev");return this.populateRouter(s,e),s}prod(e){const s=this.createRouter("prod");return this.populateRouter(s,e),s}router(e){const s=this.createRouter(this.env);return this.populateRouter(s,e),s}}module.exports=APIRouter;